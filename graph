#!/bin/bash

. config/geiger.conf
duration=(hour day week month year)

for i in ${duration[@]}; do
	rrdtool graph cpm-${i}.png \
		--end="now" \
		--start="-1$i" \
		--title="$title ($i)" \
		--vertical-label="CPM" \
		--width=720 \
		--height=240 \
		--alt-y-grid \
		--slope-mode \
		--imgformat=PNG \
		--watermark="`date`" \
		--border=0 \
		--color="BACK#FFFFFF" \
		--color="GRID#666666" \
		--color="MGRID#333333" \
		--color="ARROW#000000" \
		DEF:cpm=$rrdfile:cpm:AVERAGE \
		VDEF:now=cpm,LAST \
		VDEF:min=cpm,MINIMUM \
		VDEF:avg=cpm,AVERAGE \
		VDEF:max=cpm,MAXIMUM \
		CDEF:trend=cpm,240,TREND \
		VDEF:tnow=trend,LAST \
		VDEF:tmin=trend,MINIMUM \
		VDEF:tavg=trend,AVERAGE \
		VDEF:tmax=trend,MAXIMUM \
		CDEF:usvh=cpm,0.0057,* \
		CDEF:msvy=usvh,24,366,0.001,*,*,* \
		CDEF:mremh=usvh,10,* \
		CDEF:remy=msvy,10,* \
		VDEF:uSv_h=usvh,AVERAGE \
		VDEF:mSv_y=msvy,AVERAGE \
		VDEF:mrem_h=mremh,AVERAGE \
		VDEF:rem_y=remy,AVERAGE \
		LINE2:"cpm#5bc0de":"CPM\t" \
		AREA:"cpm#5bc0de99" \
		GPRINT:now:"now\:%4.0lf" \
		GPRINT:min:"min\:%4.0lf" \
		GPRINT:avg:"avg\:%4.0lf" \
		GPRINT:max:"max\:%4.0lf" \
		COMMENT:"\t\t\tSievert\t" \
		GPRINT:uSv_h:"%3.3lf uSv/h" \
		GPRINT:mSv_y:"%3.3lf mSv/y\l" \
		LINE2:"trend#337AB7":"Trend\t" \
		GPRINT:tnow:"now\:%4.0lf" \
		GPRINT:tmin:"min\:%4.0lf" \
		GPRINT:tavg:"avg\:%4.0lf" \
		GPRINT:tmax:"max\:%4.0lf" \
		COMMENT:"\t\t\trem\t" \
		GPRINT:mrem_h:"%3.2lf mrem/h" \
		GPRINT:rem_y:"%3.3lf rem/y\l" \
		HRULE:"50#F0AD4E" \
		HRULE:"100#D9534F"
	rrdtool graph sv-${i}.png \
		--end="now" \
		--start="-1$i" \
		--title="$title ($i)" \
		--vertical-label="Microsievert" \
		--width=720 \
		--height=240 \
		--alt-y-grid \
		--slope-mode \
		--imgformat=PNG \
		--watermark="`date`" \
		--border=0 \
		--color="BACK#FFFFFF" \
		--color="GRID#666666" \
		--color="MGRID#333333" \
		--color="ARROW#000000" \
		DEF:cpm=$rrdfile:cpm:AVERAGE \
		CDEF:usvh=cpm,0.0057,* \
		CDEF:usvm=usvh,60,/ \
		VDEF:now=usvm,LAST \
		VDEF:min=usvm,MINIMUM \
		VDEF:avg=usvm,AVERAGE \
		VDEF:max=usvm,MAXIMUM \
		CDEF:msvy=usvh,24,366,0.001,*,*,* \
		CDEF:mremh=usvh,10,* \
		CDEF:remy=msvy,10,* \
		VDEF:uSv_h=usvh,AVERAGE \
		VDEF:mSv_y=msvy,AVERAGE \
		VDEF:mrem_h=mremh,AVERAGE \
		VDEF:rem_y=remy,AVERAGE \
		LINE2:"usvm#5bc0de" \
		AREA:"usvm#5bc0de99" \
		GPRINT:now:"now\: %.8lf uSv/m" \
		GPRINT:min:"min\: %.8lf uSv/m" \
		GPRINT:avg:"avg\: %.8lf uSv/m" \
		GPRINT:max:"max\: %.8lf uSv/m\c" \
		GPRINT:uSv_h:"%3.3lf uSv/h" \
		GPRINT:mSv_y:"%3.3lf mSv/y" \
		GPRINT:mrem_h:"%3.3lf mrem/h" \
		GPRINT:rem_y:"%3.3lf rem/y\c" \
		HRULE:"50#F0AD4E" \
		HRULE:"100#D9534F"
done
